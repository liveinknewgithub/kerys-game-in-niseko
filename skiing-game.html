<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Niseko Ski Adventure!</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
        }

        .game-container {
            text-align: center;
        }

        h1 {
            color: white;
            text-shadow: 3px 3px 0 #ff6b6b, 6px 6px 0 rgba(0,0,0,0.2);
            font-size: 2.5em;
            margin-bottom: 10px;
            animation: bounce 0.5s ease infinite alternate;
        }

        @keyframes bounce {
            from { transform: translateY(0); }
            to { transform: translateY(-5px); }
        }

        #gameCanvas {
            border: 5px solid white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            cursor: pointer;
        }

        .score-display {
            display: flex;
            justify-content: space-around;
            color: white;
            font-size: 1.3em;
            margin-top: 15px;
            text-shadow: 2px 2px 0 rgba(0,0,0,0.3);
        }

        .score-item {
            background: rgba(255,255,255,0.2);
            padding: 10px 25px;
            border-radius: 25px;
            backdrop-filter: blur(5px);
        }

        .instructions {
            color: rgba(255,255,255,0.9);
            margin-top: 15px;
            font-size: 1.1em;
        }

        .instructions span {
            background: rgba(255,255,255,0.3);
            padding: 5px 15px;
            border-radius: 10px;
            margin: 0 5px;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>Niseko Ski Adventure!</h1>
        <canvas id="gameCanvas" width="500" height="600"></canvas>
        <div class="score-display">
            <div class="score-item">Coins: <span id="coins">0</span></div>
            <div class="score-item">Distance: <span id="distance">0</span>m</div>
            <div class="score-item">Best: <span id="highScore">0</span></div>
        </div>
        <p class="instructions">
            <span>← →</span> or <span>A D</span> to steer | <span>Space</span> to start
        </p>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // Game state
        let gameRunning = false;
        let gameOver = false;
        let coins = 0;
        let distance = 0;
        let highScore = localStorage.getItem('skiHighScore') || 0;
        let speed = 3;
        let maxSpeed = 8;

        // Player
        const player = {
            x: canvas.width / 2,
            y: 150,
            width: 40,
            height: 50,
            speed: 6,
            moving: 0,
            trail: []
        };

        // Game objects
        let obstacles = [];
        let coinObjects = [];
        let snowflakes = [];
        let particles = [];

        // Controls
        const keys = {};

        // Initialize snowflakes
        for (let i = 0; i < 50; i++) {
            snowflakes.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                size: Math.random() * 4 + 2,
                speed: Math.random() * 2 + 1
            });
        }

        // Event listeners
        document.addEventListener('keydown', (e) => {
            keys[e.key] = true;
            if (e.key === ' ' && !gameRunning) {
                startGame();
            }
        });

        document.addEventListener('keyup', (e) => {
            keys[e.key] = false;
        });

        canvas.addEventListener('click', () => {
            if (!gameRunning) startGame();
        });

        // Touch controls for mobile
        let touchStartX = 0;
        canvas.addEventListener('touchstart', (e) => {
            touchStartX = e.touches[0].clientX;
            if (!gameRunning) startGame();
        });

        canvas.addEventListener('touchmove', (e) => {
            e.preventDefault();
            const touchX = e.touches[0].clientX;
            const diff = touchX - touchStartX;
            player.x += diff * 0.3;
            player.x = Math.max(30, Math.min(canvas.width - 30, player.x));
            touchStartX = touchX;
        });

        function startGame() {
            gameRunning = true;
            gameOver = false;
            coins = 0;
            distance = 0;
            speed = 3;
            player.x = canvas.width / 2;
            player.trail = [];
            obstacles = [];
            coinObjects = [];
            particles = [];
            updateDisplay();
        }

        function spawnObstacle() {
            const types = ['tree', 'rock', 'snowman'];
            const type = types[Math.floor(Math.random() * types.length)];
            obstacles.push({
                x: Math.random() * (canvas.width - 60) + 30,
                y: canvas.height + 50,
                type: type,
                width: type === 'rock' ? 40 : 50,
                height: type === 'rock' ? 35 : 60
            });
        }

        function spawnCoin() {
            coinObjects.push({
                x: Math.random() * (canvas.width - 60) + 30,
                y: canvas.height + 30,
                size: 20,
                rotation: 0,
                sparkle: 0
            });
        }

        function createParticles(x, y, color, count) {
            for (let i = 0; i < count; i++) {
                particles.push({
                    x: x,
                    y: y,
                    vx: (Math.random() - 0.5) * 8,
                    vy: (Math.random() - 0.5) * 8,
                    size: Math.random() * 8 + 4,
                    color: color,
                    life: 1
                });
            }
        }

        function drawSkier() {
            const x = player.x;
            const y = player.y;
            const lean = player.moving * 0.2;

            ctx.save();
            ctx.translate(x, y);
            ctx.rotate(lean);

            // Skis
            ctx.fillStyle = '#e74c3c';
            ctx.beginPath();
            ctx.ellipse(-12, 25, 5, 20, -0.2, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.ellipse(12, 25, 5, 20, 0.2, 0, Math.PI * 2);
            ctx.fill();

            // Body (jacket)
            ctx.fillStyle = '#3498db';
            ctx.beginPath();
            ctx.roundRect(-15, -10, 30, 35, 8);
            ctx.fill();

            // Head
            ctx.fillStyle = '#ffeaa7';
            ctx.beginPath();
            ctx.arc(0, -25, 15, 0, Math.PI * 2);
            ctx.fill();

            // Helmet
            ctx.fillStyle = '#e84393';
            ctx.beginPath();
            ctx.arc(0, -28, 16, Math.PI, 0);
            ctx.fill();

            // Goggles
            ctx.fillStyle = '#2d3436';
            ctx.beginPath();
            ctx.ellipse(-6, -24, 6, 4, 0, 0, Math.PI * 2);
            ctx.ellipse(6, -24, 6, 4, 0, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillStyle = '#74b9ff';
            ctx.beginPath();
            ctx.ellipse(-6, -24, 4, 2.5, 0, 0, Math.PI * 2);
            ctx.ellipse(6, -24, 4, 2.5, 0, 0, Math.PI * 2);
            ctx.fill();

            // Smile
            ctx.strokeStyle = '#e17055';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.arc(0, -18, 6, 0.2, Math.PI - 0.2);
            ctx.stroke();

            // Ski poles
            ctx.strokeStyle = '#636e72';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(-18, 0);
            ctx.lineTo(-25, 30);
            ctx.moveTo(18, 0);
            ctx.lineTo(25, 30);
            ctx.stroke();

            ctx.restore();
        }

        function drawTree(x, y) {
            // Shadow
            ctx.fillStyle = 'rgba(0,0,0,0.2)';
            ctx.beginPath();
            ctx.ellipse(x + 5, y + 25, 20, 8, 0, 0, Math.PI * 2);
            ctx.fill();

            // Trunk
            ctx.fillStyle = '#795548';
            ctx.fillRect(x - 6, y, 12, 25);

            // Snow-covered tree layers
            ctx.fillStyle = '#27ae60';
            ctx.beginPath();
            ctx.moveTo(x, y - 50);
            ctx.lineTo(x - 25, y);
            ctx.lineTo(x + 25, y);
            ctx.closePath();
            ctx.fill();

            ctx.beginPath();
            ctx.moveTo(x, y - 70);
            ctx.lineTo(x - 20, y - 30);
            ctx.lineTo(x + 20, y - 30);
            ctx.closePath();
            ctx.fill();

            // Snow on tree
            ctx.fillStyle = 'white';
            ctx.beginPath();
            ctx.moveTo(x, y - 70);
            ctx.lineTo(x - 10, y - 50);
            ctx.lineTo(x + 10, y - 50);
            ctx.closePath();
            ctx.fill();
        }

        function drawRock(x, y) {
            ctx.fillStyle = 'rgba(0,0,0,0.2)';
            ctx.beginPath();
            ctx.ellipse(x + 3, y + 15, 22, 8, 0, 0, Math.PI * 2);
            ctx.fill();

            ctx.fillStyle = '#7f8c8d';
            ctx.beginPath();
            ctx.moveTo(x - 20, y + 10);
            ctx.lineTo(x - 15, y - 15);
            ctx.lineTo(x + 5, y - 20);
            ctx.lineTo(x + 20, y - 5);
            ctx.lineTo(x + 18, y + 10);
            ctx.closePath();
            ctx.fill();

            ctx.fillStyle = '#95a5a6';
            ctx.beginPath();
            ctx.moveTo(x - 10, y - 10);
            ctx.lineTo(x, y - 18);
            ctx.lineTo(x + 10, y - 8);
            ctx.lineTo(x + 5, y);
            ctx.closePath();
            ctx.fill();

            // Snow on rock
            ctx.fillStyle = 'white';
            ctx.beginPath();
            ctx.ellipse(x, y - 15, 12, 5, -0.2, 0, Math.PI * 2);
            ctx.fill();
        }

        function drawSnowman(x, y) {
            ctx.fillStyle = 'rgba(0,0,0,0.2)';
            ctx.beginPath();
            ctx.ellipse(x + 3, y + 20, 20, 8, 0, 0, Math.PI * 2);
            ctx.fill();

            // Body
            ctx.fillStyle = 'white';
            ctx.strokeStyle = '#bdc3c7';
            ctx.lineWidth = 2;

            ctx.beginPath();
            ctx.arc(x, y + 5, 18, 0, Math.PI * 2);
            ctx.fill();
            ctx.stroke();

            ctx.beginPath();
            ctx.arc(x, y - 25, 14, 0, Math.PI * 2);
            ctx.fill();
            ctx.stroke();

            ctx.beginPath();
            ctx.arc(x, y - 48, 10, 0, Math.PI * 2);
            ctx.fill();
            ctx.stroke();

            // Hat
            ctx.fillStyle = '#2c3e50';
            ctx.fillRect(x - 12, y - 62, 24, 8);
            ctx.fillRect(x - 7, y - 75, 14, 15);

            // Face
            ctx.fillStyle = '#e67e22';
            ctx.beginPath();
            ctx.moveTo(x, y - 48);
            ctx.lineTo(x + 12, y - 45);
            ctx.lineTo(x, y - 43);
            ctx.closePath();
            ctx.fill();

            ctx.fillStyle = '#2c3e50';
            ctx.beginPath();
            ctx.arc(x - 4, y - 52, 2, 0, Math.PI * 2);
            ctx.arc(x + 4, y - 52, 2, 0, Math.PI * 2);
            ctx.fill();

            // Buttons
            ctx.beginPath();
            ctx.arc(x, y - 30, 3, 0, Math.PI * 2);
            ctx.arc(x, y - 20, 3, 0, Math.PI * 2);
            ctx.arc(x, y, 3, 0, Math.PI * 2);
            ctx.fill();
        }

        function drawCoin(coin) {
            ctx.save();
            ctx.translate(coin.x, coin.y);
            coin.rotation += 0.1;
            coin.sparkle += 0.15;

            const scale = Math.abs(Math.cos(coin.rotation));
            ctx.scale(scale, 1);

            // Coin glow
            ctx.shadowColor = '#f1c40f';
            ctx.shadowBlur = 15;

            // Coin body
            ctx.fillStyle = '#f1c40f';
            ctx.beginPath();
            ctx.arc(0, 0, coin.size, 0, Math.PI * 2);
            ctx.fill();

            ctx.shadowBlur = 0;

            // Inner circle
            ctx.fillStyle = '#f39c12';
            ctx.beginPath();
            ctx.arc(0, 0, coin.size * 0.7, 0, Math.PI * 2);
            ctx.fill();

            // Star
            ctx.fillStyle = '#f1c40f';
            ctx.font = 'bold 16px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('★', 0, 1);

            ctx.restore();

            // Sparkles
            if (Math.sin(coin.sparkle) > 0.7) {
                ctx.fillStyle = 'white';
                ctx.beginPath();
                ctx.arc(coin.x + 15, coin.y - 15, 3, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        function drawBackground() {
            // Sky gradient
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, '#74b9ff');
            gradient.addColorStop(1, '#a29bfe');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Mountains in background
            ctx.fillStyle = '#dfe6e9';
            ctx.beginPath();
            ctx.moveTo(0, 200);
            ctx.lineTo(100, 100);
            ctx.lineTo(200, 180);
            ctx.lineTo(300, 80);
            ctx.lineTo(400, 150);
            ctx.lineTo(500, 120);
            ctx.lineTo(500, 200);
            ctx.closePath();
            ctx.fill();

            // Snow ground with ski tracks effect
            ctx.fillStyle = '#fff';
            ctx.fillRect(0, 180, canvas.width, canvas.height - 180);

            // Ski track lines (moving)
            ctx.strokeStyle = 'rgba(200, 200, 220, 0.5)';
            ctx.lineWidth = 2;
            for (let i = 0; i < 5; i++) {
                const offset = (distance * 2 + i * 150) % 200;
                ctx.beginPath();
                ctx.moveTo(100 + i * 80, 180 + offset);
                ctx.lineTo(100 + i * 80, canvas.height);
                ctx.stroke();
            }
        }

        function drawSnowflakes() {
            ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
            snowflakes.forEach(flake => {
                ctx.beginPath();
                ctx.arc(flake.x, flake.y, flake.size, 0, Math.PI * 2);
                ctx.fill();
            });
        }

        function drawParticles() {
            particles.forEach(p => {
                ctx.globalAlpha = p.life;
                ctx.fillStyle = p.color;
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.size * p.life, 0, Math.PI * 2);
                ctx.fill();
            });
            ctx.globalAlpha = 1;
        }

        function drawTrail() {
            player.trail.forEach((pos, i) => {
                const alpha = i / player.trail.length * 0.3;
                ctx.fillStyle = `rgba(200, 200, 220, ${alpha})`;
                ctx.beginPath();
                ctx.arc(pos.x - 10, pos.y, 3, 0, Math.PI * 2);
                ctx.arc(pos.x + 10, pos.y, 3, 0, Math.PI * 2);
                ctx.fill();
            });
        }

        function drawStartScreen() {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            ctx.fillStyle = 'white';
            ctx.font = 'bold 36px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('NISEKO SKI ADVENTURE', canvas.width/2, canvas.height/2 - 60);

            ctx.font = '24px Arial';
            ctx.fillText('Click or Press Space to Start!', canvas.width/2, canvas.height/2);

            ctx.font = '18px Arial';
            ctx.fillStyle = '#f1c40f';
            ctx.fillText('Collect coins and dodge obstacles!', canvas.width/2, canvas.height/2 + 40);

            // Animated skier preview
            const time = Date.now() / 500;
            player.x = canvas.width/2 + Math.sin(time) * 50;
            drawSkier();
        }

        function drawGameOver() {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            ctx.fillStyle = '#e74c3c';
            ctx.font = 'bold 48px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('CRASH!', canvas.width/2, canvas.height/2 - 80);

            ctx.fillStyle = 'white';
            ctx.font = '28px Arial';
            ctx.fillText(`Distance: ${Math.floor(distance)}m`, canvas.width/2, canvas.height/2 - 20);
            ctx.fillText(`Coins: ${coins}`, canvas.width/2, canvas.height/2 + 20);

            if (Math.floor(distance) >= highScore) {
                ctx.fillStyle = '#f1c40f';
                ctx.font = 'bold 24px Arial';
                ctx.fillText('NEW HIGH SCORE!', canvas.width/2, canvas.height/2 + 60);
            }

            ctx.fillStyle = '#2ecc71';
            ctx.font = '22px Arial';
            ctx.fillText('Click or Space to try again!', canvas.width/2, canvas.height/2 + 110);
        }

        function checkCollision(obj) {
            const playerLeft = player.x - 15;
            const playerRight = player.x + 15;
            const playerTop = player.y - 25;
            const playerBottom = player.y + 25;

            const objLeft = obj.x - obj.width/2 + 10;
            const objRight = obj.x + obj.width/2 - 10;
            const objTop = obj.y - obj.height/2 + 10;
            const objBottom = obj.y + obj.height/2;

            return playerRight > objLeft && playerLeft < objRight &&
                   playerBottom > objTop && playerTop < objBottom;
        }

        function updateDisplay() {
            document.getElementById('coins').textContent = coins;
            document.getElementById('distance').textContent = Math.floor(distance);
            document.getElementById('highScore').textContent = Math.floor(highScore);
        }

        function update() {
            if (!gameRunning) return;
            if (gameOver) return;

            // Player movement
            player.moving = 0;
            if (keys['ArrowLeft'] || keys['a'] || keys['A']) {
                player.x -= player.speed;
                player.moving = -1;
            }
            if (keys['ArrowRight'] || keys['d'] || keys['D']) {
                player.x += player.speed;
                player.moving = 1;
            }

            // Keep player in bounds
            player.x = Math.max(30, Math.min(canvas.width - 30, player.x));

            // Add to trail
            player.trail.push({x: player.x, y: player.y + 30});
            if (player.trail.length > 20) player.trail.shift();

            // Increase speed and distance
            distance += speed * 0.05;
            speed = Math.min(maxSpeed, 3 + distance * 0.005);

            // Spawn objects
            if (Math.random() < 0.02 + speed * 0.003) spawnObstacle();
            if (Math.random() < 0.015) spawnCoin();

            // Update obstacles
            obstacles.forEach(obs => {
                obs.y -= speed;
            });
            obstacles = obstacles.filter(obs => obs.y > -100);

            // Update coins
            coinObjects.forEach(coin => {
                coin.y -= speed;
            });
            coinObjects = coinObjects.filter(coin => coin.y > -50);

            // Update snowflakes
            snowflakes.forEach(flake => {
                flake.y -= speed * 0.5;
                flake.x += Math.sin(flake.y * 0.02) * 0.5;
                if (flake.y < 0) {
                    flake.y = canvas.height;
                    flake.x = Math.random() * canvas.width;
                }
            });

            // Update particles
            particles.forEach(p => {
                p.x += p.vx;
                p.y += p.vy;
                p.life -= 0.03;
            });
            particles = particles.filter(p => p.life > 0);

            // Check collisions with obstacles
            for (let obs of obstacles) {
                if (checkCollision(obs)) {
                    gameOver = true;
                    gameRunning = false;
                    createParticles(player.x, player.y, '#fff', 20);

                    if (distance > highScore) {
                        highScore = Math.floor(distance);
                        localStorage.setItem('skiHighScore', highScore);
                    }
                    break;
                }
            }

            // Check coin collection
            coinObjects = coinObjects.filter(coin => {
                const dx = player.x - coin.x;
                const dy = player.y - coin.y;
                const dist = Math.sqrt(dx*dx + dy*dy);

                if (dist < 35) {
                    coins++;
                    createParticles(coin.x, coin.y, '#f1c40f', 10);
                    return false;
                }
                return true;
            });

            updateDisplay();
        }

        function draw() {
            drawBackground();
            drawSnowflakes();
            drawTrail();

            // Draw obstacles (sorted by y for proper layering)
            obstacles.sort((a, b) => b.y - a.y);
            obstacles.forEach(obs => {
                if (obs.type === 'tree') drawTree(obs.x, obs.y);
                else if (obs.type === 'rock') drawRock(obs.x, obs.y);
                else drawSnowman(obs.x, obs.y);
            });

            coinObjects.forEach(coin => drawCoin(coin));

            if (gameRunning && !gameOver) {
                drawSkier();
            }

            drawParticles();

            if (!gameRunning && !gameOver) {
                drawStartScreen();
            }

            if (gameOver) {
                drawGameOver();
            }
        }

        function gameLoop() {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }

        // Update high score display
        document.getElementById('highScore').textContent = highScore;

        // Start the game loop
        gameLoop();
    </script>
</body>
</html>
